{"version":3,"sources":["../../../source/lib/worksheet/builder.js"],"names":["xml","require","utils","types","hyperlinks","Picture","_addSheetPr","promiseObj","Promise","resolve","reject","o","ws","opts","printOptions","fitToHeight","fitToWidth","outline","summaryBelow","autoFilter","ref","summaryRight","ele","att","outlineEle","up","pageSetup","_addDimension","firstCell","lastCell","getExcelAlpha","lastUsedCol","lastUsedRow","_addSheetViews","sheetView","tabSelected","sv","workbookViewId","rightToLeft","zoomScale","zoomScaleNormal","zoomScalePageLayoutView","showGridLines","modifiedPaneParams","Object","keys","pane","forEach","k","push","length","pEle","xSplit","ySplit","topLeftCell","activePane","state","_addSheetFormatPr","sheetFormat","baseColWidth","defaultColWidth","defaultRowHeight","thickBottom","boolToInt","thickTop","_addCols","columnCount","colsEle","colId","cols","col","colEle","min","max","width","style","hidden","customWidth","outlineLevel","collapsed","_addSheetData","rows","processRows","theseRows","r","thisRow","cellRefs","sort","sortCellRefs","rEle","spans","s","customFormat","ht","customHeight","thickBot","i","cells","addToXMLele","processNextRows","splice","_addSheetProtection","sheetProtection","includeSheetProtection","sheet","objects","scenarios","getHashOfPassword","_addAutoFilter","startRow","filterRow","startCol","endCol","endRow","firstEmptyRow","undefined","curRow","firstColumn","lastColumn","startCell","endCell","wb","definedNameCollection","addDefinedName","localSheetId","name","refFormula","_addMergeCells","mergedCells","Array","cr","_addConditionalFormatting","cfRulesCollection","_addHyperlinks","hyperlinkCollection","_addDataValidations","dataValidationCollection","_addPrintOptions","addPrintOptions","poEle","centerHorizontal","centerVertical","printHeadings","printGridLines","_addPageMargins","margins","left","right","top","bottom","header","footer","_addPageSetup","addPageSetup","psEle","paperSize","paperHeight","paperWidth","scale","firstPageNumber","pageOrder","orientation","usePrinterDefaults","blackAndWhite","draft","cellComments","useFirstPageNumber","errors","horizontalDpi","verticalDpi","copies","_addHeaderFooter","addHeaderFooter","headerFooter","hfEle","alignWithMargins","differentFirst","differentOddEven","scaleWithDoc","oddHeader","text","oddFooter","evenHeader","evenFooter","firstHeader","firstFooter","_addDrawing","drawingCollection","isEmpty","dId","relationships","indexOf","sheetXML","xmlProlog","xmlString","wsXML","begin","chunk","then","end","catch","e","Error","stack","relsXML","sheetRelRequired","relXML","create","rId","Hyperlink","location","sheetId","doc","module","exports"],"mappings":"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","file":"builder.js","sourcesContent":["const xml = require('xmlbuilder');\nconst utils = require('../utils.js');\nconst types = require('../types/index.js');\nconst hyperlinks = require('./classes/hyperlink');\nconst Picture = require('../drawing/picture.js');\n\nlet _addSheetPr = (promiseObj) => {\n\t// §18.3.1.82 sheetPr (Sheet Properties)\n\treturn new Promise((resolve, reject) => {\n\t\tlet o = promiseObj.ws.opts;\n\n\t\t// Check if any option that would require the sheetPr element to be added exists\n\t\tif (\n\t\t\to.printOptions.fitToHeight !== null ||\n\t\t\to.printOptions.fitToWidth !== null ||\n\t\t\to.outline.summaryBelow !== null ||\n\t\t\to.autoFilter.ref !== null ||\n\t\t\to.outline.summaryRight\n\n\t\t) {\n\t\t\tlet ele = promiseObj.xml.ele('sheetPr');\n\n\t\t\tif (o.autoFilter.ref) {\n\t\t\t\tele.att('enableFormatConditionsCalculation', 1);\n\t\t\t\tele.att('filterMode', 1);\n\t\t\t}\n\n\t\t\tif (o.outline.summaryBelow !== null || o.outline.summaryRight !== null) {\n\t\t\t\tlet outlineEle = ele.ele('outlinePr');\n\t\t\t\toutlineEle.att('applyStyles', 1);\n\t\t\t\to.outline.summaryBelow === true ? outlineEle.att('summaryBelow', 1) : null;\n\t\t\t\to.outline.summaryRight === true ? outlineEle.att('summaryRight', 1) : null;\n\t\t\t\toutlineEle.up();\n\t\t\t}\n\n\t\t\t// §18.3.1.65 pageSetUpPr (Page Setup Properties)\n\t\t\tif (o.pageSetup.fitToHeight !== null || o.pageSetup.fitToWidth !== null) {\n\t\t\t\tele.ele('pageSetUpPr').att('fitToPage', 1).up();\n\t\t\t}\n\t\t\tele.up();\n\t\t}\n\n\t\tresolve(promiseObj);\n\t});\n};\n\nlet _addDimension = (promiseObj) => {\n\t// §18.3.1.35 dimension (Worksheet Dimensions)\n\treturn new Promise((resolve, reject) => {\n\t\tlet firstCell = 'A1';\n\t\tlet lastCell = `${utils.getExcelAlpha(promiseObj.ws.lastUsedCol)}${promiseObj.ws.lastUsedRow}`;\n\t\tlet ele = promiseObj.xml.ele('dimension');\n\t\tele.att('ref', `${firstCell}:${lastCell}`);\n\t\tele.up();\n\n\t\tresolve(promiseObj);\n\t});\n};\n\nlet _addSheetViews = (promiseObj) => {\n\t// §18.3.1.88 sheetViews (Sheet Views)\n\treturn new Promise((resolve, reject) => {\n\t\tlet o = promiseObj.ws.opts.sheetView;\n\t\tlet ele = promiseObj.xml.ele('sheetViews');\n\t\tlet tabSelected = promiseObj.ws.opts;\n\t\tlet sv = ele.ele('sheetView')\n\t\t\t.att('tabSelected', o.tabSelected)\n\t\t\t.att('workbookViewId', o.workbookViewId)\n\t\t\t.att('rightToLeft', o.rightToLeft)\n\t\t\t.att('zoomScale', o.zoomScale)\n\t\t\t.att('zoomScaleNormal', o.zoomScaleNormal)\n\t\t\t.att('zoomScalePageLayoutView', o.zoomScalePageLayoutView)\n\t\t\t.att('showGridLines', o.showGridLines);\n\n\t\tlet modifiedPaneParams = [];\n\t\tObject.keys(o.pane).forEach((k) => {\n\t\t\tif (o.pane[k] !== null) {\n\t\t\t\tmodifiedPaneParams.push(k);\n\t\t\t}\n\t\t});\n\t\tif (modifiedPaneParams.length > 0) {\n\t\t\tlet pEle = sv.ele('pane');\n\t\t\to.pane.xSplit !== null ? pEle.att('xSplit', o.pane.xSplit) : null;\n\t\t\to.pane.ySplit !== null ? pEle.att('ySplit', o.pane.ySplit) : null;\n\t\t\to.pane.topLeftCell !== null ? pEle.att('topLeftCell', o.pane.topLeftCell) : null;\n\t\t\to.pane.activePane !== null ? pEle.att('activePane', o.pane.activePane) : null;\n\t\t\to.pane.state !== null ? pEle.att('state', o.pane.state) : null;\n\t\t\tpEle.up();\n\t\t}\n\t\tsv.up();\n\t\tele.up();\n\t\tresolve(promiseObj);\n\t});\n};\n\nlet _addSheetFormatPr = (promiseObj) => {\n\t// §18.3.1.81 sheetFormatPr (Sheet Format Properties)\n\treturn new Promise((resolve, reject) => {\n\t\tlet o = promiseObj.ws.opts.sheetFormat;\n\t\tlet ele = promiseObj.xml.ele('sheetFormatPr');\n\n\t\to.baseColWidth !== null ? ele.att('baseColWidth', o.baseColWidth) : null;\n\t\to.defaultColWidth !== null ? ele.att('defaultColWidth', o.defaultColWidth) : null;\n\t\to.defaultRowHeight !== null ? ele.att('defaultRowHeight', o.defaultRowHeight) : ele.att('defaultRowHeight', 16);\n\t\to.thickBottom !== null ? ele.att('thickBottom', utils.boolToInt(o.thickBottom)) : null;\n\t\to.thickTop !== null ? ele.att('thickTop', utils.boolToInt(o.thickTop)) : null;\n\n\n\t\tif (typeof o.defaultRowHeight === 'number') {\n\t\t\tele.att('customHeight', '1');\n\t\t}\n\t\tele.up();\n\t\tresolve(promiseObj);\n\t});\n};\n\nlet _addCols = (promiseObj) => {\n\t// §18.3.1.17 cols (Column Information)\n\treturn new Promise((resolve, reject) => {\n\n\t\tif (promiseObj.ws.columnCount > 0) {\n\t\t\tlet colsEle = promiseObj.xml.ele('cols');\n\n\t\t\tfor (let colId in promiseObj.ws.cols) {\n\t\t\t\tlet col = promiseObj.ws.cols[colId];\n\t\t\t\tlet colEle = colsEle.ele('col');\n\n\t\t\t\tcol.min !== null ? colEle.att('min', col.min) : null;\n\t\t\t\tcol.max !== null ? colEle.att('max', col.max) : null;\n\t\t\t\tcol.width !== null ? colEle.att('width', col.width) : null;\n\t\t\t\tcol.style !== null ? colEle.att('style', col.style) : null;\n\t\t\t\tcol.hidden !== null ? colEle.att('hidden', utils.boolToInt(col.hidden)) : null;\n\t\t\t\tcol.customWidth !== null ? colEle.att('customWidth', utils.boolToInt(col.customWidth)) : null;\n\t\t\t\tcol.outlineLevel !== null ? colEle.att('outlineLevel', col.outlineLevel) : null;\n\t\t\t\tcol.collapsed !== null ? colEle.att('collapsed', utils.boolToInt(col.collapsed)) : null;\n\t\t\t\tcolEle.up();\n\t\t\t}\n\t\t\tcolsEle.up();\n\t\t}\n\n\t\tresolve(promiseObj);\n\t});\n};\n\nlet _addSheetData = (promiseObj) => {\n\t// §18.3.1.80 sheetData (Sheet Data)\n\treturn new Promise((resolve, reject) => {\n\n\t\tlet ele = promiseObj.xml.ele('sheetData');\n\t\tlet rows = Object.keys(promiseObj.ws.rows);\n\n\t\tlet processRows = (theseRows) => {\n\t\t\tfor (var r = 0; r < theseRows.length; r++) {\n\t\t\t\tlet thisRow = promiseObj.ws.rows[theseRows[r]];\n\t\t\t\tthisRow.cellRefs.sort(utils.sortCellRefs);\n\n\t\t\t\tlet rEle = ele.ele('row');\n\n\t\t\t\trEle.att('r', thisRow.r);\n\t\t\t\trEle.att('spans', thisRow.spans);\n\t\t\t\tthisRow.s !== null ? rEle.att('s', thisRow.s) : null;\n\t\t\t\tthisRow.customFormat !== null ? rEle.att('customFormat', thisRow.customFormat) : null;\n\t\t\t\tthisRow.ht !== null ? rEle.att('ht', thisRow.ht) : null;\n\t\t\t\tthisRow.hidden !== null ? rEle.att('hidden', thisRow.hidden) : null;\n\t\t\t\tthisRow.customHeight === true || typeof promiseObj.ws.opts.sheetFormat.defaultRowHeight === 'number' ? rEle.att('customHeight', 1) : null;\n\t\t\t\tthisRow.outlineLevel !== null ? rEle.att('outlineLevel', thisRow.outlineLevel) : null;\n\t\t\t\tthisRow.collapsed !== null ? rEle.att('collapsed', thisRow.collapsed) : null;\n\t\t\t\tthisRow.thickTop !== null ? rEle.att('thickTop', thisRow.thickTop) : null;\n\t\t\t\tthisRow.thickBot !== null ? rEle.att('thickBot', thisRow.thickBot) : null;\n\n\t\t\t\tfor (var i = 0; i < thisRow.cellRefs.length; i++) {\n\t\t\t\t\tpromiseObj.ws.cells[thisRow.cellRefs[i]].addToXMLele(rEle);\n\t\t\t\t}\n\n\t\t\t\trEle.up();\n\t\t\t}\n\n\t\t\tprocessNextRows();\n\t\t};\n\n\t\tlet processNextRows = () => {\n\t\t\tlet theseRows = rows.splice(0, 500);\n\t\t\tif (theseRows.length === 0) {\n\t\t\t\tele.up();\n\t\t\t\treturn resolve(promiseObj);\n\t\t\t}\n\t\t\tprocessRows(theseRows);\n\t\t};\n\n\t\tprocessNextRows();\n\n\t});\n};\n\nlet _addSheetProtection = (promiseObj) => {\n\t// §18.3.1.85 sheetProtection (Sheet Protection Options)\n\treturn new Promise((resolve, reject) => {\n\t\tlet o = promiseObj.ws.opts.sheetProtection;\n\t\tlet includeSheetProtection = false;\n\t\tObject.keys(o).forEach((k) => {\n\t\t\tif (o[k] !== null) {\n\t\t\t\tincludeSheetProtection = true;\n\t\t\t}\n\t\t});\n\n\t\tif (includeSheetProtection) {\n\t\t\t// Set required fields with defaults if not specified\n\t\t\to.sheet = o.sheet !== null ? o.sheet : true;\n\t\t\to.objects = o.objects !== null ? o.objects : true;\n\t\t\to.scenarios = o.scenarios !== null ? o.scenarios : true;\n\n\t\t\tlet ele = promiseObj.xml.ele('sheetProtection');\n\t\t\tObject.keys(o).forEach((k) => {\n\t\t\t\tif (o[k] !== null) {\n\t\t\t\t\tif (k === 'password') {\n\t\t\t\t\t\tele.att('password', utils.getHashOfPassword(o[k]));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tele.att(k, utils.boolToInt(o[k]));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tele.up();\n\t\t}\n\t\tresolve(promiseObj);\n\t});\n};\n\nlet _addAutoFilter = (promiseObj) => {\n\t// §18.3.1.2 autoFilter (AutoFilter Settings)\n\treturn new Promise((resolve, reject) => {\n\t\tlet o = promiseObj.ws.opts.autoFilter;\n\n\t\tif (typeof o.startRow === 'number') {\n\t\t\tlet ele = promiseObj.xml.ele('autoFilter');\n\t\t\tlet filterRow = promiseObj.ws.rows[o.startRow];\n\n\t\t\to.startCol = typeof o.startCol === 'number' ? o.startCol : null;\n\t\t\to.endCol = typeof o.endCol === 'number' ? o.endCol : null;\n\n\t\t\tif (typeof o.endRow !== 'number') {\n\t\t\t\tlet firstEmptyRow = undefined;\n\t\t\t\tlet curRow = o.startRow;\n\t\t\t\twhile (firstEmptyRow === undefined) {\n\t\t\t\t\tif (!promiseObj.ws.rows[curRow]) {\n\t\t\t\t\t\tfirstEmptyRow = curRow;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcurRow++;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\to.endRow = firstEmptyRow - 1;\n\t\t\t}\n\n\t\t\t// Columns to sort not manually set. filter all columns in this row containing data.\n\t\t\tif (typeof o.startCol !== 'number' || typeof o.endCol !== 'number') {\n\t\t\t\to.startCol = filterRow.firstColumn;\n\t\t\t\to.endCol = filterRow.lastColumn;\n\t\t\t}\n\n\t\t\tlet startCell = utils.getExcelAlpha(o.startCol) + o.startRow;\n\t\t\tlet endCell = utils.getExcelAlpha(o.endCol) + o.endRow;\n\n\t\t\tele.att('ref', `${startCell}:${endCell}`);\n\t\t\tpromiseObj.ws.wb.definedNameCollection.addDefinedName({\n\t\t\t\thidden: 1,\n\t\t\t\tlocalSheetId: promiseObj.ws.localSheetId,\n\t\t\t\tname: '_xlnm._FilterDatabase',\n\t\t\t\trefFormula: '\\'' + promiseObj.ws.name + '\\'!' +\n\t\t\t\t\t'$' + utils.getExcelAlpha(o.startCol) +\n\t\t\t\t\t'$' + o.startRow +\n\t\t\t\t\t':' +\n\t\t\t\t\t'$' + utils.getExcelAlpha(o.endCol) +\n\t\t\t\t\t'$' + o.endRow\n\t\t\t});\n\t\t\tele.up();\n\t\t}\n\t\tresolve(promiseObj);\n\t});\n};\n\nlet _addMergeCells = (promiseObj) => {\n\t// §18.3.1.55 mergeCells (Merge Cells)\n\treturn new Promise((resolve, reject) => {\n\n\t\tif (promiseObj.ws.mergedCells instanceof Array && promiseObj.ws.mergedCells.length > 0) {\n\t\t\tlet ele = promiseObj.xml.ele('mergeCells').att('count', promiseObj.ws.mergedCells.length);\n\t\t\tpromiseObj.ws.mergedCells.forEach((cr) => {\n\t\t\t\tele.ele('mergeCell').att('ref', cr).up();\n\t\t\t});\n\t\t\tele.up();\n\t\t}\n\n\t\tresolve(promiseObj);\n\t});\n};\n\nlet _addConditionalFormatting = (promiseObj) => {\n\t// §18.3.1.18 conditionalFormatting (Conditional Formatting)\n\treturn new Promise((resolve, reject) => {\n\t\tpromiseObj.ws.cfRulesCollection.addToXMLele(promiseObj.xml);\n\t\tresolve(promiseObj);\n\t});\n};\n\nlet _addHyperlinks = (promiseObj) => {\n\t// §18.3.1.48 hyperlinks (Hyperlinks)\n\treturn new Promise((resolve, reject) => {\n\t\tpromiseObj.ws.hyperlinkCollection.addToXMLele(promiseObj.xml);\n\t\tresolve(promiseObj);\n\t});\n};\n\nlet _addDataValidations = (promiseObj) => {\n\t// §18.3.1.33 dataValidations (Data Validations)\n\treturn new Promise((resolve, reject) => {\n\t\tif (promiseObj.ws.dataValidationCollection.length > 0) {\n\t\t\tpromiseObj.ws.dataValidationCollection.addToXMLele(promiseObj.xml);\n\t\t}\n\t\tresolve(promiseObj);\n\t});\n};\n\nlet _addPrintOptions = (promiseObj) => {\n\t// §18.3.1.70 printOptions (Print Options)\n\treturn new Promise((resolve, reject) => {\n\n\t\tlet addPrintOptions = false;\n\t\tlet o = promiseObj.ws.opts.printOptions;\n\t\tObject.keys(o).forEach((k) => {\n\t\t\tif (o[k] !== null) {\n\t\t\t\taddPrintOptions = true;\n\t\t\t}\n\t\t});\n\n\t\tif (addPrintOptions) {\n\t\t\tlet poEle = promiseObj.xml.ele('printOptions');\n\t\t\to.centerHorizontal === true ? poEle.att('horizontalCentered', 1) : null;\n\t\t\to.centerVertical === true ? poEle.att('verticalCentered', 1) : null;\n\t\t\to.printHeadings === true ? poEle.att('headings', 1) : null;\n\t\t\tif (o.printGridLines === true) {\n\t\t\t\tpoEle.att('gridLines', 1);\n\t\t\t\tpoEle.att('gridLinesSet', 1);\n\t\t\t}\n\t\t\tpoEle.up();\n\t\t}\n\n\t\tresolve(promiseObj);\n\t});\n};\n\nlet _addPageMargins = (promiseObj) => {\n\t// §18.3.1.62 pageMargins (Page Margins)\n\treturn new Promise((resolve, reject) => {\n\t\tlet o = promiseObj.ws.opts.margins;\n\n\t\tpromiseObj.xml.ele('pageMargins')\n\t\t\t.att('left', o.left)\n\t\t\t.att('right', o.right)\n\t\t\t.att('top', o.top)\n\t\t\t.att('bottom', o.bottom)\n\t\t\t.att('header', o.header)\n\t\t\t.att('footer', o.footer)\n\t\t\t.up();\n\n\t\tresolve(promiseObj);\n\t});\n};\n\nlet _addPageSetup = (promiseObj) => {\n\t// §18.3.1.63 pageSetup (Page Setup Settings)\n\treturn new Promise((resolve, reject) => {\n\n\t\tlet addPageSetup = false;\n\t\tlet o = promiseObj.ws.opts.pageSetup;\n\t\tObject.keys(o).forEach((k) => {\n\t\t\tif (o[k] !== null) {\n\t\t\t\taddPageSetup = true;\n\t\t\t}\n\t\t});\n\n\t\tif (addPageSetup === true) {\n\t\t\tlet psEle = promiseObj.xml.ele('pageSetup');\n\t\t\to.paperSize !== null ? psEle.att('paperSize', types.paperSize[o.paperSize]) : null;\n\t\t\to.paperHeight !== null ? psEle.att('paperHeight', o.paperHeight) : null;\n\t\t\to.paperWidth !== null ? psEle.att('paperWidth', o.paperWidth) : null;\n\t\t\to.scale !== null ? psEle.att('scale', o.scale) : null;\n\t\t\to.firstPageNumber !== null ? psEle.att('firstPageNumber', o.firstPageNumber) : null;\n\t\t\to.fitToWidth !== null ? psEle.att('fitToWidth', o.fitToWidth) : null;\n\t\t\to.fitToHeight !== null ? psEle.att('fitToHeight', o.fitToHeight) : null;\n\t\t\to.pageOrder !== null ? psEle.att('pageOrder', o.pageOrder) : null;\n\t\t\to.orientation !== null ? psEle.att('orientation', o.orientation) : null;\n\t\t\to.usePrinterDefaults !== null ? psEle.att('usePrinterDefaults', utils.boolToInt(o.usePrinterDefaults)) : null;\n\t\t\to.blackAndWhite !== null ? psEle.att('blackAndWhite', utils.boolToInt(o.blackAndWhite)) : null;\n\t\t\to.draft !== null ? psEle.att('draft', utils.boolToInt(o.draft)) : null;\n\t\t\to.cellComments !== null ? psEle.att('cellComments', o.cellComments) : null;\n\t\t\to.useFirstPageNumber !== null ? psEle.att('useFirstPageNumber', utils.boolToInt(o.useFirstPageNumber)) : null;\n\t\t\to.errors !== null ? psEle.att('errors', o.errors) : null;\n\t\t\to.horizontalDpi !== null ? psEle.att('horizontalDpi', o.horizontalDpi) : null;\n\t\t\to.verticalDpi !== null ? psEle.att('verticalDpi', o.verticalDpi) : null;\n\t\t\to.copies !== null ? psEle.att('copies', o.copies) : null;\n\t\t\tpsEle.up();\n\t\t}\n\n\t\tresolve(promiseObj);\n\t});\n};\n\nlet _addHeaderFooter = (promiseObj) => {\n\t// §18.3.1.46 headerFooter (Header Footer Settings)\n\treturn new Promise((resolve, reject) => {\n\n\t\tlet addHeaderFooter = false;\n\t\tlet o = promiseObj.ws.opts.headerFooter;\n\t\tObject.keys(o).forEach((k) => {\n\t\t\tif (o[k] !== null) {\n\t\t\t\taddHeaderFooter = true;\n\t\t\t}\n\t\t});\n\n\t\tif (addHeaderFooter === true) {\n\t\t\tlet hfEle = promiseObj.xml.ele('headerFooter');\n\n\t\t\to.alignWithMargins !== null ? hfEle.att('alignWithMargins', utils.boolToInt(o.alignWithMargins)) : null;\n\t\t\to.differentFirst !== null ? hfEle.att('differentFirst', utils.boolToInt(o.differentFirst)) : null;\n\t\t\to.differentOddEven !== null ? hfEle.att('differentOddEven', utils.boolToInt(o.differentOddEven)) : null;\n\t\t\to.scaleWithDoc !== null ? hfEle.att('scaleWithDoc', utils.boolToInt(o.scaleWithDoc)) : null;\n\n\t\t\to.oddHeader !== null ? hfEle.ele('oddHeader').text(o.oddHeader).up() : null;\n\t\t\to.oddFooter !== null ? hfEle.ele('oddFooter').text(o.oddFooter).up() : null;\n\t\t\to.evenHeader !== null ? hfEle.ele('evenHeader').text(o.evenHeader).up() : null;\n\t\t\to.evenFooter !== null ? hfEle.ele('evenFooter').text(o.evenFooter).up() : null;\n\t\t\to.firstHeader !== null ? hfEle.ele('firstHeader').text(o.firstHeader).up() : null;\n\t\t\to.firstFooter !== null ? hfEle.ele('firstFooter').text(o.firstFooter).up() : null;\n\t\t\thfEle.up();\n\t\t}\n\n\t\tresolve(promiseObj);\n\t});\n};\n\nlet _addDrawing = (promiseObj) => {\n\t// §18.3.1.36 drawing (Drawing)\n\treturn new Promise((resolve, reject) => {\n\t\tif (!promiseObj.ws.drawingCollection.isEmpty) {\n\t\t\tlet dId = promiseObj.ws.relationships.indexOf('drawing') + 1;\n\t\t\tpromiseObj.xml.ele('drawing').att('r:id', 'rId' + dId).up();\n\t\t}\n\t\tresolve(promiseObj);\n\t});\n};\n\nlet sheetXML = (ws) => {\n\treturn new Promise((resolve, reject) => {\n\n\t\tlet xmlProlog = '<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>';\n\t\tlet xmlString = '';\n\t\tlet wsXML = xml.begin((chunk) => {\n\t\t\txmlString += chunk;\n\t\t})\n\t\t\t.ele('worksheet')\n\t\t\t.att('mc:Ignorable', 'x14ac')\n\t\t\t.att('xmlns', 'http://schemas.openxmlformats.org/spreadsheetml/2006/main')\n\t\t\t.att('xmlns:mc', 'http://schemas.openxmlformats.org/markup-compatibility/2006')\n\t\t\t.att('xmlns:r', 'http://schemas.openxmlformats.org/officeDocument/2006/relationships')\n\t\t\t.att('xmlns:x14ac', 'http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac');\n\n\t\t// Excel complains if specific elements on not in the correct order in the XML doc.\n\t\tlet promiseObj = { xml: wsXML, ws: ws };\n\n\t\t_addSheetPr(promiseObj)\n\t\t\t.then(_addDimension)\n\t\t\t.then(_addSheetViews)\n\t\t\t.then(_addSheetFormatPr)\n\t\t\t.then(_addCols)\n\t\t\t.then(_addSheetData)\n\t\t\t.then(_addSheetProtection)\n\t\t\t.then(_addAutoFilter)\n\t\t\t.then(_addMergeCells)\n\t\t\t.then(_addConditionalFormatting)\n\t\t\t.then(_addDataValidations)\n\t\t\t.then(_addHyperlinks)\n\t\t\t.then(_addPrintOptions)\n\t\t\t.then(_addPageMargins)\n\t\t\t.then(_addPageSetup)\n\t\t\t.then(_addHeaderFooter)\n\t\t\t.then(_addDrawing)\n\t\t\t.then((promiseObj) => {\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\twsXML.end();\n\t\t\t\t\tresolve(xmlString);\n\t\t\t\t});\n\t\t\t})\n\t\t\t.then((xml) => {\n\t\t\t\tresolve(xml);\n\t\t\t})\n\t\t\t.catch((e) => {\n\t\t\t\tthrow new Error(e.stack);\n\t\t\t});\n\t});\n};\n\nlet relsXML = (ws) => {\n\treturn new Promise((resolve, reject) => {\n\t\tlet sheetRelRequired = false;\n\t\tif (ws.relationships.length > 0) {\n\t\t\tsheetRelRequired = true;\n\t\t}\n\n\t\tif (sheetRelRequired === false) {\n\t\t\tresolve();\n\t\t}\n\n\t\tlet relXML = xml.create(\n\t\t\t'Relationships', {\n\t\t\t\t'version': '1.0',\n\t\t\t\t'encoding': 'UTF-8',\n\t\t\t\t'standalone': true\n\t\t\t}\n\t\t);\n\t\trelXML.att('xmlns', 'http://schemas.openxmlformats.org/package/2006/relationships');\n\n\t\tws.relationships.forEach((r, i) => {\n\t\t\tlet rId = 'rId' + (i + 1);\n\t\t\tif (r instanceof hyperlinks.Hyperlink) {\n\t\t\t\trelXML.ele('Relationship')\n\t\t\t\t\t.att('Id', rId)\n\t\t\t\t\t.att('Target', r.location)\n\t\t\t\t\t.att('TargetMode', 'External')\n\t\t\t\t\t.att('Type', 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink');\n\t\t\t} else if (r === 'drawing') {\n\t\t\t\trelXML.ele('Relationship')\n\t\t\t\t\t.att('Id', rId)\n\t\t\t\t\t.att('Target', '../drawings/drawing' + ws.sheetId + '.xml')\n\t\t\t\t\t.att('Type', 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing');\n\t\t\t}\n\t\t});\n\t\tlet xmlString = relXML.doc().end();\n\t\tresolve(xmlString);\n\t});\n};\n\nmodule.exports = { sheetXML, relsXML };\n"]}