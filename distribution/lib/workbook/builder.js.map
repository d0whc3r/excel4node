{"version":3,"sources":["../../../source/lib/workbook/builder.js"],"names":["xmlbuilder","require","JSZip","fs","CTColor","addRootContentTypesXML","promiseObj","Promise","resolve","reject","xml","create","att","contentTypesAdded","wb","sheets","forEach","s","i","drawingCollection","length","extensionsAdded","drawings","d","indexOf","extension","typeRef","contentType","ele","push","sheetId","xmlString","doc","end","xmlOutVars","xlsx","file","addRootRelsXML","folder","addWorkBookXML","booksViewEle","sheetsEle","name","definedNameCollection","isEmpty","addToXMLele","addWorkBookRelsXML","addWorkSheetsXML","curSheet","processNextSheet","thisSheet","generateXML","then","generateRelsXML","catch","e","logger","error","stack","addSharedStringsXML","sharedStrings","txt","Array","thisSI","theseRuns","currProps","curRun","undefined","props","text","Object","keys","k","value","run","thisRun","thisRunProps","bold","italics","strike","outline","shadow","condense","extend","color","thisColor","size","underline","vertAlign","addStylesXML","styleData","numFmts","nfXML","nf","fontXML","fonts","f","fillXML","fills","fXML","borderXML","borders","b","cellXfsXML","styles","addXFtoXMLele","dxfCollection","addDrawingsXML","mediaCollection","ws","drawingRelXML","drawingsXML","kind","target","id","readFileSync","imagePath","rId","type","drawingsXMLStr","drawingRelXMLStr","writeToBuffer","WorkSheet","opts","jszip","generateAsync","buf","module","exports"],"mappings":"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","file":"builder.js","sourcesContent":["const xmlbuilder = require('xmlbuilder');\nconst JSZip = require('jszip');\nconst fs = require('fs');\nconst CTColor = require('../style/classes/ctColor.js');\n\nlet addRootContentTypesXML = (promiseObj) => {\n\t// Required as stated in §12.2\n\treturn new Promise((resolve, reject) => {\n\t\tlet xml = xmlbuilder.create(\n\t\t\t\t'Types', {\n\t\t\t\t\t'version': '1.0',\n\t\t\t\t\t'encoding': 'UTF-8',\n\t\t\t\t\t'standalone': true\n\t\t\t\t}\n\t\t\t)\n\t\t\t.att('xmlns', 'http://schemas.openxmlformats.org/package/2006/content-types');\n\n\t\tlet contentTypesAdded = [];\n\t\tpromiseObj.wb.sheets.forEach((s, i) => {\n\t\t\tif (s.drawingCollection.length > 0) {\n\t\t\t\tlet extensionsAdded = [];\n\t\t\t\ts.drawingCollection.drawings.forEach((d) => {\n\t\t\t\t\tif (extensionsAdded.indexOf(d.extension) < 0) {\n\t\t\t\t\t\tlet typeRef = d.contentType + '.' + d.extension;\n\t\t\t\t\t\tif (contentTypesAdded.indexOf(typeRef) < 0) {\n\t\t\t\t\t\t\txml.ele('Default').att('ContentType', d.contentType).att('Extension', d.extension);\n\t\t\t\t\t\t}\n\t\t\t\t\t\textensionsAdded.push(d.extension);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\txml.ele('Default').att('ContentType', 'application/xml').att('Extension', 'xml');\n\t\txml.ele('Default').att('ContentType', 'application/vnd.openxmlformats-package.relationships+xml').att('Extension', 'rels');\n\t\txml.ele('Override').att('ContentType', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml').att('PartName', '/xl/workbook.xml');\n\t\tpromiseObj.wb.sheets.forEach((s, i) => {\n\t\t\txml.ele('Override')\n\t\t\t\t.att('ContentType', 'application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml')\n\t\t\t\t.att('PartName', `/xl/worksheets/sheet${i + 1}.xml`);\n\n\t\t\tif (s.drawingCollection.length > 0) {\n\t\t\t\txml.ele('Override')\n\t\t\t\t\t.att('ContentType', 'application/vnd.openxmlformats-officedocument.drawing+xml')\n\t\t\t\t\t.att('PartName', '/xl/drawings/drawing' + s.sheetId + '.xml');\n\t\t\t}\n\t\t});\n\t\txml.ele('Override').att('ContentType', 'application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml').att('PartName', '/xl/styles.xml');\n\t\txml.ele('Override').att('ContentType', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml').att('PartName', '/xl/sharedStrings.xml');\n\n\t\tlet xmlString = xml.doc().end(promiseObj.xmlOutVars);\n\t\tpromiseObj.xlsx.file('[Content_Types].xml', xmlString);\n\t\tresolve(promiseObj);\n\t});\n};\n\nlet addRootRelsXML = (promiseObj) => {\n\t// Required as stated in §12.2\n\treturn new Promise((resolve, reject) => {\n\t\tlet xml = xmlbuilder.create(\n\t\t\t\t'Relationships', {\n\t\t\t\t\t'version': '1.0',\n\t\t\t\t\t'encoding': 'UTF-8',\n\t\t\t\t\t'standalone': true\n\t\t\t\t}\n\t\t\t)\n\t\t\t.att('xmlns', 'http://schemas.openxmlformats.org/package/2006/relationships');\n\n\t\txml\n\t\t\t.ele('Relationship')\n\t\t\t.att('Id', 'rId1')\n\t\t\t.att('Type', 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument')\n\t\t\t.att('Target', 'xl/workbook.xml');\n\n\t\tlet xmlString = xml.doc().end(promiseObj.xmlOutVars);\n\t\tpromiseObj.xlsx.folder('_rels').file('.rels', xmlString);\n\t\tresolve(promiseObj);\n\n\t});\n};\n\nlet addWorkBookXML = (promiseObj) => {\n\t// Required as stated in §12.2\n\treturn new Promise((resolve, reject) => {\n\n\t\tlet xml = xmlbuilder.create(\n\t\t\t'workbook', {\n\t\t\t\t'version': '1.0',\n\t\t\t\t'encoding': 'UTF-8',\n\t\t\t\t'standalone': true\n\t\t\t}\n\t\t);\n\t\txml.att('mc:Ignorable', 'x15');\n\t\txml.att('xmlns', 'http://schemas.openxmlformats.org/spreadsheetml/2006/main');\n\t\txml.att('xmlns:mc', 'http://schemas.openxmlformats.org/markup-compatibility/2006');\n\t\txml.att('xmlns:r', 'http://schemas.openxmlformats.org/officeDocument/2006/relationships');\n\t\txml.att('xmlns:x15', 'http://schemas.microsoft.com/office/spreadsheetml/2010/11/main');\n\n\t\tlet booksViewEle = xml.ele('bookViews');\n\t\tbooksViewEle.ele('workbookView')\n\t\t\t.att('xWindow', '240')\n\t\t\t.att('yWindow', '15')\n\t\t\t.att('windowWidth', '8505')\n\t\t\t.att('windowHeight', '6240');\n\n\t\tlet sheetsEle = xml.ele('sheets');\n\t\tpromiseObj.wb.sheets.forEach((s, i) => {\n\t\t\tsheetsEle.ele('sheet')\n\t\t\t\t.att('name', s.name)\n\t\t\t\t.att('sheetId', i + 1)\n\t\t\t\t.att('r:id', `rId${i + 1}`);\n\t\t});\n\n\t\tif (!promiseObj.wb.definedNameCollection.isEmpty) {\n\t\t\tpromiseObj.wb.definedNameCollection.addToXMLele(xml);\n\t\t}\n\n\t\tlet xmlString = xml.doc().end(promiseObj.xmlOutVars);\n\t\tpromiseObj.xlsx.folder('xl').file('workbook.xml', xmlString);\n\t\tresolve(promiseObj);\n\n\t});\n};\n\nlet addWorkBookRelsXML = (promiseObj) => {\n\t// Required as stated in §12.2\n\treturn new Promise((resolve, reject) => {\n\n\t\tlet xml = xmlbuilder.create(\n\t\t\t\t'Relationships', {\n\t\t\t\t\t'version': '1.0',\n\t\t\t\t\t'encoding': 'UTF-8',\n\t\t\t\t\t'standalone': true\n\t\t\t\t}\n\t\t\t)\n\t\t\t.att('xmlns', 'http://schemas.openxmlformats.org/package/2006/relationships');\n\n\t\txml\n\t\t\t.ele('Relationship')\n\t\t\t.att('Id', `rId${promiseObj.wb.sheets.length + 1}`)\n\t\t\t.att('Target', 'sharedStrings.xml')\n\t\t\t.att('Type', 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings');\n\n\t\txml\n\t\t\t.ele('Relationship')\n\t\t\t.att('Id', `rId${promiseObj.wb.sheets.length + 2}`)\n\t\t\t.att('Target', 'styles.xml')\n\t\t\t.att('Type', 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles');\n\n\t\tpromiseObj.wb.sheets.forEach((s, i) => {\n\t\t\txml\n\t\t\t\t.ele('Relationship')\n\t\t\t\t.att('Id', `rId${i + 1}`)\n\t\t\t\t.att('Target', `worksheets/sheet${i + 1}.xml`)\n\t\t\t\t.att('Type', 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet');\n\t\t});\n\n\t\tlet xmlString = xml.doc().end(promiseObj.xmlOutVars);\n\t\tpromiseObj.xlsx.folder('xl').folder('_rels').file('workbook.xml.rels', xmlString);\n\t\tresolve(promiseObj);\n\n\t});\n};\n\nlet addWorkSheetsXML = (promiseObj) => {\n\t// Required as stated in §12.2\n\treturn new Promise((resolve, reject) => {\n\n\t\tlet curSheet = 0;\n\n\t\tlet processNextSheet = () => {\n\t\t\tlet thisSheet = promiseObj.wb.sheets[curSheet];\n\t\t\tif (thisSheet) {\n\t\t\t\tcurSheet++;\n\t\t\t\tthisSheet.generateXML()\n\t\t\t\t\t.then((xml) => {\n\t\t\t\t\t\treturn new Promise((resolve) => {\n\t\t\t\t\t\t\t// Add worksheet to zip\n\t\t\t\t\t\t\tpromiseObj.xlsx.folder('xl').folder('worksheets').file(`sheet${curSheet}.xml`, xml);\n\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\treturn thisSheet.generateRelsXML();\n\t\t\t\t\t})\n\t\t\t\t\t.then((xml) => {\n\t\t\t\t\t\treturn new Promise((resolve) => {\n\t\t\t\t\t\t\tif (xml) {\n\t\t\t\t\t\t\t\tpromiseObj.xlsx.folder('xl').folder('worksheets').folder('_rels').file(`sheet${curSheet}.xml.rels`, xml);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.then(processNextSheet)\n\t\t\t\t\t.catch((e) => {\n\t\t\t\t\t\tpromiseObj.wb.logger.error(e.stack);\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tresolve(promiseObj);\n\t\t\t}\n\t\t};\n\t\tprocessNextSheet();\n\n\t});\n};\n\n/**\n * Generate XML for SharedStrings.xml file and add it to zip file. Called from _writeToBuffer()\n * @private\n * @memberof WorkBook\n * @param {Object} promiseObj object containing jszip instance, workbook intance and xmlvars\n * @return {Promise} Resolves with promiseObj\n */\nlet addSharedStringsXML = (promiseObj) => {\n\t// §12.3.15 Shared String Table Part\n\treturn new Promise((resolve, reject) => {\n\n\t\tlet xml = xmlbuilder.create(\n\t\t\t\t'sst', {\n\t\t\t\t\t'version': '1.0',\n\t\t\t\t\t'encoding': 'UTF-8',\n\t\t\t\t\t'standalone': true\n\t\t\t\t}\n\t\t\t)\n\t\t\t.att('count', promiseObj.wb.sharedStrings.length)\n\t\t\t.att('uniqueCount', promiseObj.wb.sharedStrings.length)\n\t\t\t.att('xmlns', 'http://schemas.openxmlformats.org/spreadsheetml/2006/main');\n\n\t\tpromiseObj.wb.sharedStrings.forEach((s) => {\n\t\t\tif (typeof s === 'string') {\n\t\t\t\txml.ele('si').ele('t').txt(s);\n\t\t\t} else if (s instanceof Array) {\n\n\t\t\t\tlet thisSI = xml.ele('si');\n\t\t\t\tlet theseRuns = []; // §18.4.4 r (Rich Text Run)\n\t\t\t\tlet currProps = {};\n\t\t\t\tlet curRun;\n\t\t\t\tlet i = 0;\n\t\t\t\twhile (i < s.length) {\n\t\t\t\t\tif (typeof s[i] === 'string') {\n\t\t\t\t\t\tif (curRun === undefined) {\n\t\t\t\t\t\t\ttheseRuns.push({\n\t\t\t\t\t\t\t\tprops: {},\n\t\t\t\t\t\t\t\ttext: ''\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tcurRun = theseRuns[theseRuns.length - 1];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcurRun.text = curRun.text + s[i];\n\t\t\t\t\t} else if (typeof s[i] === 'object') {\n\t\t\t\t\t\ttheseRuns.push({\n\t\t\t\t\t\t\tprops: {},\n\t\t\t\t\t\t\ttext: ''\n\t\t\t\t\t\t});\n\t\t\t\t\t\tcurRun = theseRuns[theseRuns.length - 1];\n\t\t\t\t\t\tObject.keys(s[i]).forEach((k) => {\n\t\t\t\t\t\t\tcurrProps[k] = s[i][k];\n\t\t\t\t\t\t});\n\t\t\t\t\t\tObject.keys(currProps).forEach((k) => {\n\t\t\t\t\t\t\tcurRun.props[k] = currProps[k];\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (s[i].value !== undefined) {\n\t\t\t\t\t\t\tcurRun.text = s[i].value;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\ti++;\n\t\t\t\t}\n\n\t\t\t\ttheseRuns.forEach((run) => {\n\t\t\t\t\tif (Object.keys(run).length < 1) {\n\t\t\t\t\t\tthisSI.ele('t', run.text).att('xml:space', 'preserve');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet thisRun = thisSI.ele('r');\n\t\t\t\t\t\tlet thisRunProps = thisRun.ele('rPr');\n\t\t\t\t\t\ttypeof run.props.name === 'string' ? thisRunProps.ele('rFont').att('val', run.props.name) : null;\n\t\t\t\t\t\trun.props.bold === true ? thisRunProps.ele('b') : null;\n\t\t\t\t\t\trun.props.italics === true ? thisRunProps.ele('i') : null;\n\t\t\t\t\t\trun.props.strike === true ? thisRunProps.ele('strike') : null;\n\t\t\t\t\t\trun.props.outline === true ? thisRunProps.ele('outline') : null;\n\t\t\t\t\t\trun.props.shadow === true ? thisRunProps.ele('shadow') : null;\n\t\t\t\t\t\trun.props.condense === true ? thisRunProps.ele('condense') : null;\n\t\t\t\t\t\trun.props.extend === true ? thisRunProps.ele('extend') : null;\n\t\t\t\t\t\tif (typeof run.props.color === 'string') {\n\t\t\t\t\t\t\tlet thisColor = new CTColor(run.props.color);\n\t\t\t\t\t\t\tthisColor.addToXMLele(thisRunProps);\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttypeof run.props.size === 'number' ? thisRunProps.ele('sz').att('val', run.props.size) : null;\n\t\t\t\t\t\trun.props.underline === true ? thisRunProps.ele('u') : null;\n\t\t\t\t\t\ttypeof run.props.vertAlign === 'string' ? thisRunProps.ele('vertAlign').att('val', run.props.vertAlign) : null;\n\t\t\t\t\t\tthisRun.ele('t', run.text).att('xml:space', 'preserve');\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t}\n\t\t});\n\n\t\tlet xmlString = xml.doc().end(promiseObj.xmlOutVars);\n\t\tpromiseObj.xlsx.folder('xl').file('sharedStrings.xml', xmlString);\n\n\t\tresolve(promiseObj);\n\n\t});\n};\n\nlet addStylesXML = (promiseObj) => {\n\t// §12.3.20 Styles Part\n\treturn new Promise((resolve, reject) => {\n\n\t\tlet xml = xmlbuilder.create(\n\t\t\t\t'styleSheet', {\n\t\t\t\t\t'version': '1.0',\n\t\t\t\t\t'encoding': 'UTF-8',\n\t\t\t\t\t'standalone': true\n\t\t\t\t}\n\t\t\t)\n\t\t\t.att('mc:Ignorable', 'x14ac')\n\t\t\t.att('xmlns', 'http://schemas.openxmlformats.org/spreadsheetml/2006/main')\n\t\t\t.att('xmlns:mc', 'http://schemas.openxmlformats.org/markup-compatibility/2006')\n\t\t\t.att('xmlns:x14ac', 'http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac');\n\n\t\tif (promiseObj.wb.styleData.numFmts.length > 0) {\n\t\t\tlet nfXML = xml\n\t\t\t\t.ele('numFmts')\n\t\t\t\t.att('count', promiseObj.wb.styleData.numFmts.length);\n\t\t\tpromiseObj.wb.styleData.numFmts.forEach((nf) => {\n\t\t\t\tnf.addToXMLele(nfXML);\n\t\t\t});\n\t\t}\n\n\t\tlet fontXML = xml\n\t\t\t.ele('fonts')\n\t\t\t.att('count', promiseObj.wb.styleData.fonts.length);\n\t\tpromiseObj.wb.styleData.fonts.forEach((f) => {\n\t\t\tf.addToXMLele(fontXML);\n\t\t});\n\n\t\tlet fillXML = xml\n\t\t\t.ele('fills')\n\t\t\t.att('count', promiseObj.wb.styleData.fills.length);\n\t\tpromiseObj.wb.styleData.fills.forEach((f) => {\n\t\t\tlet fXML = fillXML.ele('fill');\n\t\t\tf.addToXMLele(fXML);\n\t\t});\n\n\t\tlet borderXML = xml\n\t\t\t.ele('borders')\n\t\t\t.att('count', promiseObj.wb.styleData.borders.length);\n\t\tpromiseObj.wb.styleData.borders.forEach((b) => {\n\t\t\tb.addToXMLele(borderXML);\n\t\t});\n\n\n\t\tlet cellXfsXML = xml\n\t\t\t.ele('cellXfs')\n\t\t\t.att('count', promiseObj.wb.styles.length);\n\t\tpromiseObj.wb.styles.forEach((s) => {\n\t\t\ts.addXFtoXMLele(cellXfsXML);\n\t\t});\n\n\t\tif (promiseObj.wb.dxfCollection.length > 0) {\n\t\t\tpromiseObj.wb.dxfCollection.addToXMLele(xml);\n\t\t}\n\n\t\tlet xmlString = xml.doc().end(promiseObj.xmlOutVars);\n\t\tpromiseObj.xlsx.folder('xl').file('styles.xml', xmlString);\n\n\t\tresolve(promiseObj);\n\t});\n};\n\nlet addDrawingsXML = (promiseObj) => {\n\treturn new Promise((resolve) => {\n\t\tif (!promiseObj.wb.mediaCollection.isEmpty) {\n\n\t\t\tpromiseObj.wb.sheets.forEach((ws) => {\n\t\t\t\tif (!ws.drawingCollection.isEmpty) {\n\n\t\t\t\t\tlet drawingRelXML = xmlbuilder.create('Relationships', {\n\t\t\t\t\t\t'version': '1.0',\n\t\t\t\t\t\t'encoding': 'UTF-8',\n\t\t\t\t\t\t'standalone': true\n\t\t\t\t\t})\n\t\t\t\t\t\t.att('xmlns', 'http://schemas.openxmlformats.org/package/2006/relationships');\n\n\t\t\t\t\tlet drawingsXML = xmlbuilder.create(\n\t\t\t\t\t\t'xdr:wsDr', {\n\t\t\t\t\t\t\t'version': '1.0',\n\t\t\t\t\t\t\t'encoding': 'UTF-8',\n\t\t\t\t\t\t\t'standalone': true\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\tdrawingsXML\n\t\t\t\t\t\t.att('xmlns:a', 'http://schemas.openxmlformats.org/drawingml/2006/main')\n\t\t\t\t\t\t.att('xmlns:xdr', 'http://schemas.openxmlformats.org/drawingml/2006/spreadsheetDrawing');\n\n\t\t\t\t\tws.drawingCollection.drawings.forEach((d) => {\n\n\t\t\t\t\t\tif (d.kind === 'image') {\n\t\t\t\t\t\t\tlet target = 'image' + d.id + '.' + d.extension;\n\t\t\t\t\t\t\tpromiseObj.xlsx.folder('xl').folder('media').file(target, fs.readFileSync(d.imagePath));\n\n\t\t\t\t\t\t\tdrawingRelXML.ele('Relationship')\n\t\t\t\t\t\t\t\t.att('Id', d.rId)\n\t\t\t\t\t\t\t\t.att('Target', '../media/' + target)\n\t\t\t\t\t\t\t\t.att('Type', d.type);\n\n\t\t\t\t\t\t}\n\n\n\n\t\t\t\t\t\td.addToXMLele(drawingsXML);\n\n\t\t\t\t\t});\n\n\t\t\t\t\tlet drawingsXMLStr = drawingsXML.doc().end(promiseObj.xmlOutVars);\n\t\t\t\t\tlet drawingRelXMLStr = drawingRelXML.doc().end(promiseObj.xmlOutVars);\n\t\t\t\t\tpromiseObj.xlsx.folder('xl').folder('drawings').file('drawing' + ws.sheetId + '.xml', drawingsXMLStr);\n\t\t\t\t\tpromiseObj.xlsx.folder('xl').folder('drawings').folder('_rels').file('drawing' + ws.sheetId + '.xml.rels', drawingRelXMLStr);\n\t\t\t\t}\n\t\t\t});\n\n\t\t}\n\t\tresolve(promiseObj);\n\t});\n};\n\n/**\n * Use JSZip to generate file to a node buffer\n * @private\n * @memberof WorkBook\n * @param {WorkBook} wb WorkBook instance\n * @return {Promise} resolves with Buffer\n */\nlet writeToBuffer = (wb) => {\n\treturn new Promise((resolve, reject) => {\n\t\tlet promiseObj = {\n\t\t\twb: wb,\n\t\t\txlsx: new JSZip(),\n\t\t\txmlOutVars: {}\n\t\t};\n\n\t\tif (promiseObj.wb.sheets.length === 0) {\n\t\t\tpromiseObj.wb.WorkSheet();\n\t\t}\n\n\t\taddRootContentTypesXML(promiseObj)\n\t\t\t.then(addWorkSheetsXML)\n\t\t\t.then(addRootRelsXML)\n\t\t\t.then(addWorkBookXML)\n\t\t\t.then(addWorkBookRelsXML)\n\t\t\t.then(addSharedStringsXML)\n\t\t\t.then(addStylesXML)\n\t\t\t.then(addDrawingsXML)\n\t\t\t.then(() => {\n\t\t\t\twb.opts.jszip.type = 'nodebuffer';\n\t\t\t\tpromiseObj.xlsx.generateAsync(wb.opts.jszip)\n\t\t\t\t\t.then((buf) => {\n\t\t\t\t\t\tresolve(buf);\n\t\t\t\t\t})\n\t\t\t\t\t.catch((e) => {\n\t\t\t\t\t\treject(e);\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.catch((e) => {\n\t\t\t\twb.logger.error(e.stack);\n\t\t\t\treject(e);\n\t\t\t});\n\n\t});\n};\n\nmodule.exports = { writeToBuffer };\n"]}